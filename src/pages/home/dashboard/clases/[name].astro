---
import EditSched from '@components/home/classes/EditSched';
import DashboardLayout from '@layouts/DashboardLayout.astro';
import { getGlobalSistems } from '@lib/database';
import { getClassInfo } from '@lib/database';
import { getClassMapFromInfo } from '@lib/format';

const { user, preferences } = Astro.locals;
const { name } = Astro.params;
if (!name) {
	return Astro.redirect('/home/dashboard/clases/');
}
const classInfo = await getClassInfo(user.uid, name);
const global_sistems = await getGlobalSistems();
---

<DashboardLayout hideSidebar>
	<main
		slot="content"
		class="w-full flex flex-col gap-4 p-8 items-center justify-center"
	>
		<div class="w-full max-w-2xl flex items-center justify-between gap-4">
			<h1 class="text-4xl">{name}</h1>
		</div>
		<div class="w-full max-w-2xl flex flex-col gap-4">
			<div class="flex flex-col gap-2">
				<EditSched
					client:only="preact"
					time_sistems={global_sistems}
					sistem_id={preferences.custom_time_sistem}
					class_name={name}
					initial_fields={classInfo}
				/>
				<div class="flex flex-col gap-2">
					<label class="text-base">
						<h1 class="text-2xl">Sistema de Evaluacion</h1>
					</label>
					<p class="text-gray-500 text-lg m-4">ðŸš§ AÃºn no disponible ðŸš§</p>
				</div>
			</div>
			<form
				action="/api/home/delclass/"
				method="post"
				class="w-full max-w-2xl mt-8"
			>
				<input type="hidden" id="name" name="name" value={name} />
				<button type="submit" class="text-lg btn btn-error w-full">
					<span class="icon-[material-symbols--delete]"></span>
					<p>Eliminar clase</p>
				</button>
			</form>
		</div>
	</main>
</DashboardLayout>
