---
import Clock from '@components/home/Clock';
import GeneralSideBar from '@components/home/GeneralSideBar.astro';
import RangeView from '@components/home/RangeView.astro';
import SisClock from '@components/home/SisClock';
import DashboardLayout from '@layouts/DashboardLayout.astro';
import { getClasses, getTimeSistem, getTodaySchedule } from '@lib/database';
import { getDay } from '@lib/time';
const date = new Date();
const { user, preferences } = Astro.locals;
const classes = await getClasses(user.uid);
const time_sistem = await getTimeSistem(preferences.custom_time_sistem)
const todaySched = await getTodaySchedule(user.uid, preferences.custom_time_sistem, date.getDay());
---

<DashboardLayout>
	<main slot="content" class="w-full h-full flex flex-col gap-4 relative">
		<header
			id="dashboard-header"
			class="p-4 w-full flex justify-between border border-neutral bg-[#0C0F11] fixed z-[1]"
		>
			<div>
				<div class="text-3xl flex flex-wrap">
					<h3 class="mr-2">{getDay(date)}</h3>
					{
						!!time_sistem && <SisClock client:only="preact" sistem_type={time_sistem.type} sistem={time_sistem.sistem}/>
					}
				</div>
				<p class="text-lg text-gray-500">{date.toLocaleDateString()}</p>
			</div>
			<Clock client:only="preact" />
		</header>
		<section
			id="dashboard-section"
			class="flex flex-col gap-4 p-4 items-center mt-[100px] z-0"
		>
			{!classes.length && 
			<h2 class="text-gray-500 text-lg mt-4">Â¿Aun no has agregado clases?</h2>
			<p class="text-gray-500">Agrega tus clases y horarios en la seccion</p>
			<a href="/home/dashboard/clases/" class="btn btn-primary">Clases</a>
			}
			{
				!time_sistem && <p>No time sistem -> sistem = hour</p>	
			}
			{
				!!time_sistem && time_sistem.type === 'range' ? (
					<RangeView schedule={todaySched} time_sistem={time_sistem} />
				) : (
					<p>Time sistem not supported</p>
				)
			}
			
		</section>
	</main>
	<GeneralSideBar slot="sidebar" />
</DashboardLayout>

